groups:
  - name: container_labels
    interval: 15s
    rules:
      # Create container info metric from Docker SD target labels
      - record: container_info
        expr: |
          up{job="docker"} * 0 + 1
        labels:
          info: "metadata"

      # Container CPU usage with name label (join on container_id)
      - record: container_cpu_usage_rate
        expr: |
          sum by (container_id) (rate(container_cpu_usage_seconds_total{container_id!=""}[5m]))
          * on(container_id) group_left(container_name)
          (up{job="docker"} * 0 + 1)

      # Container memory usage with name label
      - record: container_memory_usage
        expr: |
          container_memory_usage_bytes{container_id!=""}
          * on(container_id) group_left(container_name)
          (up{job="docker"} * 0 + 1)
